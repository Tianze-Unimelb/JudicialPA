<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸æ³•å¿ƒç†æƒ…æ„Ÿè®¡ç®—åˆ†æç³»ç»Ÿ</title>
    <link rel="stylesheet" href="../static/css/style.css">
    <link rel="stylesheet" href="../static/css/dashboard.css">
    <script src="../static/js/app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- å¤´éƒ¨å¯¼èˆª -->
        <header class="main-header">
            <div class="header-content">
                <div class="logo">
                    <svg class="logo-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    <span class="logo-text">å¸æ³•å¿ƒç†æƒ…æ„Ÿåˆ†æç³»ç»Ÿ</span>
                </div>
                <nav class="main-nav">
                    <a href="#" @click="currentView = 'dashboard'" :class="{active: currentView === 'dashboard'}">
                        <i class="nav-icon">ğŸ“Š</i>ä»ªè¡¨ç›˜
                    </a>
                    <a href="#" @click="currentView = 'analysis'" :class="{active: currentView === 'analysis'}">
                        <i class="nav-icon">ğŸ”</i>å®æ—¶åˆ†æ
                    </a>
                    <a href="#" @click="currentView = 'reports'" :class="{active: currentView === 'reports'}">
                        <i class="nav-icon">ğŸ“‹</i>åˆ†ææŠ¥å‘Š
                    </a>
                    <a href="#" @click="currentView = 'settings'" :class="{active: currentView === 'settings'}">
                        <i class="nav-icon">âš™ï¸</i>ç³»ç»Ÿè®¾ç½®
                    </a>
                </nav>
                <div class="user-info">
                    <span class="user-name">ç®¡ç†å‘˜</span>
                    <div class="user-avatar"></div>
                </div>
            </div>
        </header>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="main-content">
            <!-- ä»ªè¡¨ç›˜è§†å›¾ -->
            <div v-if="currentView === 'dashboard'" class="dashboard-view">
                <div class="dashboard-header">
                    <h1>å®æ—¶ç›‘æ§ä»ªè¡¨ç›˜</h1>
                    <div class="time-display">{{ currentTime }}</div>
                </div>

                <div class="metrics-grid">
                    <!-- æƒ…æ„Ÿå¼ºåº¦æŒ‡æ•°å¡ç‰‡ -->
                    <div class="metric-card emotion-intensity">
                        <div class="card-header">
                            <span class="card-title">æƒ…æ„Ÿå¼ºåº¦æŒ‡æ•°</span>
                            <span class="card-icon">ğŸ­</span>
                        </div>
                        <div class="card-body">
                            <div class="intensity-gauge">
                                <div class="gauge-value">{{ emotionIntensity }}</div>
                                <div class="gauge-chart" ref="gaugeChart"></div>
                            </div>
                            <div class="intensity-status" :class="intensityLevel">
                                {{ intensityStatus }}
                            </div>
                        </div>
                    </div>

                    <!-- å¿ƒç†çŠ¶æ€é›·è¾¾å›¾ -->
                    <div class="metric-card psychological-radar">
                        <div class="card-header">
                            <span class="card-title">å¿ƒç†çŠ¶æ€è¯„ä¼°</span>
                            <span class="card-icon">ğŸ§ </span>
                        </div>
                        <div class="card-body">
                            <div class="radar-chart" ref="radarChart"></div>
                        </div>
                    </div>

                    <!-- é£é™©é¢„è­¦é¢æ¿ -->
                    <div class="metric-card risk-warnings">
                        <div class="card-header">
                            <span class="card-title">é£é™©é¢„è­¦</span>
                            <span class="card-icon">âš ï¸</span>
                        </div>
                        <div class="card-body">
                            <div class="warning-list">
                                <div v-for="warning in riskWarnings" :key="warning.id"
                                     class="warning-item" :class="warning.level">
                                    <span class="warning-icon">
                                        {{ warning.level === 'high' ? 'ğŸ”´' :
                                           warning.level === 'medium' ? 'ğŸŸ¡' : 'ğŸŸ¢' }}
                                    </span>
                                    <div class="warning-content">
                                        <div class="warning-title">{{ warning.type }}</div>
                                        <div class="warning-desc">{{ warning.description }}</div>
                                    </div>
                                    <div class="warning-time">{{ formatTime(warning.timestamp) }}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- å®æ—¶æƒ…ç»ªåˆ†å¸ƒ -->
                    <div class="metric-card emotion-distribution">
                        <div class="card-header">
                            <span class="card-title">å®æ—¶æƒ…ç»ªåˆ†å¸ƒ</span>
                            <span class="card-icon">ğŸ“Š</span>
                        </div>
                        <div class="card-body">
                            <div class="emotion-bars">
                                <div v-for="(value, emotion) in emotionDistribution"
                                     :key="emotion" class="emotion-bar">
                                    <div class="emotion-label">{{ translateEmotion(emotion) }}</div>
                                    <div class="emotion-progress">
                                        <div class="progress-bar"
                                             :style="{width: value + '%', backgroundColor: getEmotionColor(emotion)}">
                                        </div>
                                    </div>
                                    <div class="emotion-value">{{ value }}%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å¹²é¢„å»ºè®®é¢æ¿ -->
                <div class="intervention-panel">
                    <h2 class="panel-title">å¹²é¢„å»ºè®®</h2>
                    <div class="intervention-grid">
                        <div v-for="(interventions, type) in interventionSuggestions"
                             :key="type" class="intervention-type">
                            <h3 class="intervention-header">{{ translateInterventionType(type) }}</h3>
                            <div class="intervention-list">
                                <div v-for="intervention in interventions"
                                     :key="intervention.action" class="intervention-item">
                                    <span class="intervention-priority" :class="intervention.priority">
                                        {{ intervention.priority }}
                                    </span>
                                    <span class="intervention-action">{{ intervention.action }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å®æ—¶åˆ†æè§†å›¾ -->
            <div v-if="currentView === 'analysis'" class="analysis-view">
                <div class="analysis-header">
                    <h1>å¤šæ¨¡æ€å®æ—¶åˆ†æ</h1>
                </div>

                <div class="analysis-container">
                    <!-- è§†é¢‘åˆ†æåŒºåŸŸ -->
                    <div class="analysis-section video-analysis">
                        <h2 class="section-title">é¢éƒ¨è¡¨æƒ…åˆ†æ</h2>
                        <div class="video-container">
                            <video ref="videoElement" class="video-feed" autoplay></video>
                            <canvas ref="canvasElement" class="video-overlay"></canvas>
                            <div class="video-controls">
                                <button @click="toggleCamera" class="control-btn">
                                    {{ cameraActive ? 'å…³é—­æ‘„åƒå¤´' : 'å¼€å¯æ‘„åƒå¤´' }}
                                </button>
                                <button @click="captureFrame" class="control-btn" :disabled="!cameraActive">
                                    æ•è·ç”»é¢
                                </button>
                            </div>
                        </div>
                        <div class="face-emotion-results" v-if="faceEmotions">
                            <h3>æ£€æµ‹åˆ°çš„è¡¨æƒ…</h3>
                            <div class="emotion-tags">
                                <span v-for="(value, emotion) in faceEmotions.emotions"
                                      :key="emotion" class="emotion-tag"
                                      v-if="value > 0.1">
                                    {{ translateEmotion(emotion) }}: {{ (value * 100).toFixed(1) }}%
                                </span>
                            </div>
                            <div class="micro-expressions" v-if="faceEmotions.micro_expressions">
                                <h3>å¾®è¡¨æƒ…æŒ‡æ ‡</h3>
                                <div class="micro-grid">
                                    <div v-for="(value, expr) in faceEmotions.micro_expressions"
                                         :key="expr" class="micro-item">
                                        <span class="micro-label">{{ translateMicroExpression(expr) }}</span>
                                        <div class="micro-bar">
                                            <div class="micro-fill" :style="{width: value * 100 + '%'}"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- è¯­éŸ³åˆ†æåŒºåŸŸ -->
                    <div class="analysis-section audio-analysis">
                        <h2 class="section-title">è¯­éŸ³æƒ…æ„Ÿåˆ†æ</h2>
                        <div class="audio-container">
                            <div class="audio-visualizer" ref="audioVisualizer"></div>
                            <div class="audio-controls">
                                <button @click="toggleRecording" class="control-btn" :class="{recording: isRecording}">
                                    {{ isRecording ? 'åœæ­¢å½•éŸ³' : 'å¼€å§‹å½•éŸ³' }}
                                </button>
                                <button @click="playbackAudio" class="control-btn" :disabled="!audioData">
                                    æ’­æ”¾å½•éŸ³
                                </button>
                            </div>
                            <div class="recording-time" v-if="isRecording">
                                å½•éŸ³æ—¶é•¿: {{ recordingTime }}s
                            </div>
                        </div>
                        <div class="voice-analysis-results" v-if="voiceAnalysis">
                            <div class="voice-metrics">
                                <div class="metric-item">
                                    <span class="metric-label">éŸ³è°ƒ</span>
                                    <span class="metric-value">{{ voiceAnalysis.pitch.type }}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">éŸ³é‡</span>
                                    <span class="metric-value">{{ voiceAnalysis.volume.level }}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">è¯­é€Ÿ</span>
                                    <span class="metric-value">{{ voiceAnalysis.speed.type }}</span>
                                </div>
                            </div>
                            <div class="voice-emotion-chart" ref="voiceEmotionChart"></div>
                        </div>
                    </div>

                    <!-- æ–‡æœ¬åˆ†æåŒºåŸŸ -->
                    <div class="analysis-section text-analysis">
                        <h2 class="section-title">æ–‡æœ¬æƒ…æ„Ÿåˆ†æ</h2>
                        <div class="text-container">
                            <textarea v-model="textInput" class="text-input"
                                    placeholder="è¯·è¾“å…¥æˆ–ç²˜è´´è¦åˆ†æçš„æ–‡æœ¬å†…å®¹..."></textarea>
                            <div class="text-controls">
                                <button @click="analyzeText" class="control-btn" :disabled="!textInput">
                                    åˆ†ææ–‡æœ¬
                                </button>
                                <button @click="clearText" class="control-btn">
                                    æ¸…ç©ºæ–‡æœ¬
                                </button>
                            </div>
                        </div>
                        <div class="text-analysis-results" v-if="textAnalysis">
                            <div class="semantic-summary">
                                <h3>è¯­ä¹‰åˆ†ææ‘˜è¦</h3>
                                <div class="summary-item">
                                    <span class="summary-label">æ•´ä½“æƒ…æ„Ÿ:</span>
                                    <span class="summary-value" :class="textAnalysis.overall.label.toLowerCase()">
                                        {{ textAnalysis.overall.label }}
                                    </span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">ä¸€è‡´æ€§:</span>
                                    <div class="consistency-bar">
                                        <div class="consistency-fill"
                                             :style="{width: textAnalysis.consistency * 100 + '%'}"></div>
                                    </div>
                                    <span class="consistency-value">{{ (textAnalysis.consistency * 100).toFixed(1) }}%</span>
                                </div>
                            </div>
                            <div class="keyword-emotions" v-if="textAnalysis.keywords">
                                <h3>å…³é”®è¯æƒ…æ„Ÿ</h3>
                                <div class="keyword-cloud">
                                    <span v-for="keyword in textAnalysis.keywords"
                                          :key="keyword.word" class="keyword-tag"
                                          :class="keyword.emotion">
                                        {{ keyword.word }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æŠ¥å‘Šè§†å›¾ -->
            <div v-if="currentView === 'reports'" class="reports-view">
                <div class="reports-header">
                    <h1>åˆ†ææŠ¥å‘Š</h1>
                    <button @click="generateReport" class="generate-report-btn">ç”Ÿæˆç»¼åˆæŠ¥å‘Š</button>
                </div>

                <div class="report-content" v-if="comprehensiveReport">
                    <div class="report-section">
                        <h2>ç»¼åˆè¯„ä¼°æŠ¥å‘Š</h2>
                        <div class="report-meta">
                            <span>ç”Ÿæˆæ—¶é—´: {{ formatDateTime(comprehensiveReport.timestamp) }}</span>
                            <span>æŠ¥å‘Šç¼–å·: {{ comprehensiveReport.id }}</span>
                        </div>

                        <div class="report-summary">
                            <h3>æ‰§è¡Œæ‘˜è¦</h3>
                            <div class="summary-grid">
                                <div class="summary-card">
                                    <div class="summary-label">æ€»ä½“æƒ…æ„Ÿå¼ºåº¦</div>
                                    <div class="summary-value">{{ comprehensiveReport.emotion_intensity_index }}</div>
                                </div>
                                <div class="summary-card">
                                    <div class="summary-label">å¿ƒç†é£é™©ç­‰çº§</div>
                                    <div class="summary-value risk-level"
                                         :class="comprehensiveReport.risk_level">
                                        {{ comprehensiveReport.risk_level }}
                                    </div>
                                </div>
                                <div class="summary-card">
                                    <div class="summary-label">æ²Ÿé€šéšœç¢è¯„ä¼°</div>
                                    <div class="summary-value">
                                        {{ comprehensiveReport.communication_assessment }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="report-details">
                            <h3>è¯¦ç»†åˆ†æç»“æœ</h3>
                            <!-- è¿™é‡Œæ·»åŠ è¯¦ç»†çš„åˆ†æç»“æœå±•ç¤º -->
                        </div>

                        <div class="report-recommendations">
                            <h3>ä¸“ä¸šå»ºè®®</h3>
                            <div class="recommendations-list">
                                <div v-for="rec in comprehensiveReport.recommendations"
                                     :key="rec.id" class="recommendation-item">
                                    <span class="rec-priority" :class="rec.priority">{{ rec.priority }}</span>
                                    <span class="rec-content">{{ rec.content }}</span>
                                </div>
                            </div>
                        </div>

                        <div class="report-actions">
                            <button @click="downloadReport" class="action-btn primary">ä¸‹è½½æŠ¥å‘Š</button>
                            <button @click="shareReport" class="action-btn">åˆ†äº«æŠ¥å‘Š</button>
                            <button @click="printReport" class="action-btn">æ‰“å°æŠ¥å‘Š</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è®¾ç½®è§†å›¾ -->
            <div v-if="currentView === 'settings'" class="settings-view">
                <h1>ç³»ç»Ÿè®¾ç½®</h1>
                <div class="settings-sections">
                    <div class="settings-section">
                        <h2>åˆ†æå‚æ•°è®¾ç½®</h2>
                        <div class="settings-group">
                            <label class="setting-item">
                                <span class="setting-label">æƒ…æ„Ÿå¼ºåº¦é˜ˆå€¼</span>
                                <input type="range" v-model="settings.emotionThreshold" min="0" max="100">
                                <span class="setting-value">{{ settings.emotionThreshold }}</span>
                            </label>
                            <label class="setting-item">
                                <span class="setting-label">é£é™©é¢„è­¦çº§åˆ«</span>
                                <select v-model="settings.riskLevel">
                                    <option value="low">ä½</option>
                                    <option value="medium">ä¸­</option>
                                    <option value="high">é«˜</option>
                                </select>
                            </label>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h2>æ•°æ®éšç§è®¾ç½®</h2>
                        <div class="settings-group">
                            <label class="setting-item">
                                <input type="checkbox" v-model="settings.anonymizeData">
                                <span class="setting-label">åŒ¿ååŒ–æ•°æ®å¤„ç†</span>
                            </label>
                            <label class="setting-item">
                                <input type="checkbox" v-model="settings.encryptStorage">
                                <span class="setting-label">åŠ å¯†æœ¬åœ°å­˜å‚¨</span>
                            </label>
                        </div>
                    </div>

                    <div class="settings-actions">
                        <button @click="saveSettings" class="action-btn primary">ä¿å­˜è®¾ç½®</button>
                        <button @click="resetSettings" class="action-btn">æ¢å¤é»˜è®¤</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- æ‚¬æµ®åŠ©æ‰‹ -->
        <div class="floating-assistant" :class="{expanded: assistantExpanded}">
            <div class="assistant-header" @click="toggleAssistant">
                <span class="assistant-icon">ğŸ’¡</span>
                <span class="assistant-title">æ™ºèƒ½åŠ©æ‰‹</span>
            </div>
            <div class="assistant-body" v-if="assistantExpanded">
                <div class="assistant-messages">
                    <div v-for="msg in assistantMessages" :key="msg.id"
                         class="assistant-message" :class="msg.type">
                        <span class="message-text">{{ msg.text }}</span>
                        <span class="message-time">{{ formatTime(msg.timestamp) }}</span>
                    </div>
                </div>
                <div class="assistant-input">
                    <input v-model="assistantQuery" @keyup.enter="sendAssistantQuery"
                           placeholder="è¯¢é—®ä»»ä½•é—®é¢˜...">
                    <button @click="sendAssistantQuery">å‘é€</button>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
